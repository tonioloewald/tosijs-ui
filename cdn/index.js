import{Component as e,elements as t,xin as s,xinValue as i,vars as a,debounce as l}from"xinjs";import{marked as o}from"marked";let n={};function r(e){if(void 0===n[e]){let s=t.script({src:e});document.head.append(s),n[e]=new Promise(e=>{s.onload=e})}return n[e]}let d={};function c(e){if(void 0===d[e]){let s=t.link({rel:"stylesheet",type:"text/css",href:e});document.head.append(s),d[e]=new Promise(e=>{s.onload=e})}return d[e]}class h extends e{content=null;src="";json="";config={renderer:"svg",loop:!0,autoplay:!0};static bodymovinAvailable;animation;styleNode=e.StyleNode({":host":{width:400,height:400,display:"inline-block"}});_loading=!1;get loading(){return this._loading}constructor(){super(),this.initAttributes("src","json"),void 0===h.bodymovinAvailable&&(h.bodymovinAvailable=void 0===globalThis.bodymovinPlayer?r("https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.12.2/lottie.min.js"):Promise.resolve(),console.log(h.bodymovinAvailable))}doneLoading=()=>{this._loading=!1};load=()=>{this._loading=!0,this.config.container=this.shadowRoot,""!==this.json?(this.config.animationData=this.json,delete this.config.path):""!==this.src?(delete this.config.animationData,this.config.path=this.src):console.log("%c<bodymovin-player>%c expected either %cjson%c (animation data) or %csrc% c(url) but found neither.","color: #44f; background: #fff; padding: 0 5px","color: default","color: #44f; background: #fff; padding: 0 5px","color: default","color: #44f; background: #fff; padding: 0 5px","color: default"),this.animation&&(this.animation.destroy(),this.shadowRoot.querySelector("svg").remove()),this.animation=globalThis.bodymovin.loadAnimation(this.config),this.animation.addEventListener("DOMLoaded",this.doneLoading)};render(){super.render(),h.bodymovinAvailable.then(this.load).catch(e=>{console.error(e)})}}let u=h.elementCreator({tag:"bodymovin-player"}),p=(e,s)=>{let i=t.div({style:{content:" ",position:"fixed",top:0,left:0,right:0,bottom:0,cursor:s}});document.body.append(i),i.addEventListener("mousemove",t=>{!0===e(t)&&i.remove()}),i.addEventListener("mouseup",t=>{e(t),i.remove()})},{div:b,span:m,template:f}=t,v=e=>e,g=(class extends e{value={array:[],filteredArray:[]};charWidth=15;rowHeight=30;minColumnWidth=30;constructor(){super()}get filter(){return"function"==typeof this.value.filter?this.value.filter:v}get columns(){if(!Array.isArray(this.value.columns)){let{array:e}=this.value;this.value.columns=Object.keys(e[0]||{}).map(t=>{let s=function(e,t,s){let i=e.find(e=>void 0!==e[t]&&null!==e[t]);if(void 0!==i){let e=i[t];switch(typeof e){case"string":if(e.match(/^\d+(\.\d+)?$/))return 6*s;if(e.includes(" "))return 20*s;return 12*s;case"number":return 6*s;case"boolean":return 5*s;case"object":break;default:return 8*s}}return!1}(e,t,this.charWidth);return{name:t.replace(/([a-z])([A-Z])/g,"$1 $2").toLocaleLowerCase(),prop:t,visible:!1!==s,width:s||0}})}return this.value.columns}get visibleColumns(){return this.columns.filter(e=>!1!==e.visible)}content=null;getColumn(e){let t=e.clientX-this.getBoundingClientRect().x,s=0,i=[],a=this.visibleColumns.find(e=>{if(!1!==e.visible)return s+=e.width,i.push(s),5>Math.abs(t-s)});return a}trackMouse=e=>{let t=this.getColumn(e);void 0!==t?this.style.cursor="col-resize":this.style.cursor=""};resizeColumn=e=>{let t=this.getColumn(e);if(void 0!==t){let s=t.width,i=e.clientX;p(e=>{let a=e.clientX-i+s;t.width=a>this.minColumnWidth?a:this.minColumnWidth,this.setColumnWidths()},"col-resize")}};connectedCallback(){super.connectedCallback(),this.addEventListener("mousemove",this.trackMouse),this.addEventListener("mousedown",this.resizeColumn)}setColumnWidths(){this.style.setProperty("--grid-columns",this.visibleColumns.map(e=>e.width+"px").join(" "))}render(){super.render(),s[this.instanceId]=this.filter(i(this.value.array)),this.textContent="",this.style.display="flex",this.style.flexDirection="column";let{visibleColumns:e}=this;this.setColumnWidths();let t={display:"grid",gridTemplateColumns:a.gridColumns,height:this.rowHeight+"px"},l={overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},o={display:"inline-block",minWidth:a.charWidth,cursor:"default"};this.append(b({class:"thead"},b({class:"tr",style:t},...e.map(e=>m({class:"th",style:l},e.name,!1!==e.sortable?m({class:"t-sorter",style:o}):void 0)))),b({class:"tbody",style:{content:" ",minHeight:"200px",flex:"1 1 100px",overflow:"hidden",overflowY:"scroll"},bindList:{value:this.instanceId,virtual:{height:this.rowHeight}}},f(b({class:"tr",style:t},...e.map(e=>m({class:"td",style:l,bindText:`^.${e.prop}`}))))))}}).elementCreator({tag:"data-table"}),{input:y}=t,x=e=>e,w="null filter, everything matches";class k extends e{value="";filter=x;title=w;content=y({style:{width:"100%",height:"100%"},placeholder:"needle name:foo !isFalse isTrue! lat:>0"});constructor(){super(),this.initAttributes("title")}buildFilter=l(e=>{let t,s;let i=[],a=e.split(/\s+/).filter(e=>""!==e).map(e=>{if(e.startsWith("!")){let t=e.slice(1);return i.push(`"${t}" is truthy`),e=>!e[t]}if(e.endsWith("!")){let t=e.slice(0,e.length-1);return i.push(`"${t}" is falsy`),e=>!!e[t]}if(e.includes(":")){let[t,s]=e.split(":");return s.startsWith("<")?(i.push(`"${s}" < "${t}"`),s=s.slice(1),e=>e[t]&&e[t]<s):s.startsWith(">")?(s=s.slice(1),i.push(`"${s}" > "${t}"`),e=>e[t]&&e[t]>s):(s=s.toLocaleLowerCase(),i.push(`"${s}" in "${t}"`),e=>e[t]&&String(e[t]).toLocaleLowerCase().includes(s))}{let t=e.toLocaleLowerCase();return i.push(`"${t}" anywhere`),e=>Object.keys(e).find(s=>String(e[s]).toLocaleLowerCase().includes(t))}});0===a.length?(s=w,t=x):(s=i.join(", and "),t=e=>e.filter(e=>null!==e&&"object"==typeof e&&void 0===a.find(t=>!t(e)))),this.filter!==t&&(this.title=s,this.filter=t,this.dispatchEvent(new Event("change")))});reset(){this.filter!==x&&(this.title=w,this.filter=x,this.dispatchEvent(new Event("change")))}handleInput=e=>{let{input:t}=this.refs;this.buildFilter(t.value),this.value=t.value,e.stopPropagation(),e.preventDefault()};connectedCallback(){super.connectedCallback();let{input:e}=this.refs;e.value=this.value,e.addEventListener("input",this.handleInput),e.addEventListener("change",this.handleInput),this.style.position="relative"}render(){super.render();let{input:e}=this.refs;e.value=this.value}}let C=k.elementCreator({tag:"filter-builder"}),$=[{name:"streets",url:"mapbox://styles/mapbox/streets-v10"},{name:"outdoors",url:"mapbox://styles/mapbox/outdoors-v10"},{name:"light",url:"mapbox://styles/mapbox/light-v9"},{name:"dark",url:"mapbox://styles/mapbox/dark-v9"},{name:"satellite",url:"mapbox://styles/mapbox/satellite-v9"},{name:"sateliite + streets",url:"mapbox://styles/mapbox/satellite-streets-v10"},{name:"preview day",url:"mapbox://styles/mapbox/navigation-preview-day-v2"},{name:"preview night",url:"mapbox://styles/mapbox/navigation-preview-night-v2"},{name:"guidance day",url:"mapbox://styles/mapbox/navigation-guidance-day-v2"},{name:"guidance night",url:"mapbox://styles/mapbox/navigation-guidance-night-v2"}],{div:A}=t;class L extends e{coords="65.01715565258993,25.48081004203459,12";content=A({style:{width:"100%",height:"100%"}});get map(){return this._map}mapStyle=$[0];token="";static mapboxCSSAvailable;static mapboxAvailable;_map;styleNode=e.StyleNode({":host":{display:"inline-block",position:"relative",width:"400px",height:"400px",textAlign:"left"}});constructor(){super(),this.initAttributes("coords","token","mapStyle"),void 0===L.mapboxCSSAvailable&&(L.mapboxCSSAvailable=c("https://api.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.css").catch(e=>{console.error("failed to load mapbox-gl.css",e)}),L.mapboxAvailable=r("https://api.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.js").catch(e=>{console.error("failed to load mapbox-gl.js",e)}))}connectedCallback(){super.connectedCallback(),this.token||console.error("mapbox requires an access token which you can provide via the token attribute")}render(){if(super.render(),!this.token)return;let{div:e}=this.refs,[t,s,i]=this.coords.split(",").map(e=>Number(e));L.mapboxAvailable.then(()=>{globalThis.mapboxgl.accessToken=this.token,this._map=new globalThis.mapboxgl.Map({container:e,style:this.mapStyle.url,zoom:i,center:[s,t]}),this._map.on("render",()=>this._map.resize())})}}let S=L.elementCreator({tag:"map-box"}),T=(class extends e{src="";value="";constructor(){super(),this.initAttributes("src")}connectedCallback(){super.connectedCallback(),""!==this.src?(async()=>{let e=await fetch(this.src);this.value=await e.text()})():""===this.value&&(this.value=null!=this.textContent?this.textContent:"")}render(){super.render(),this.innerHTML=o(this.value)}}).elementCreator(),{div:j,slot:W}=t;class E extends e{value=0;styleNode=e.StyleNode({":host":{display:"flex",flexDirection:"column",position:"relative",overflow:"hidden"},slot:{position:"relative",display:"block",flex:"1 1 auto",overflow:"hidden",overflowY:"auto"},"::slotted([hidden])":{display:"none !important"},":host .tab-holder":{display:"flex",flexDirection:"column"},":host .tabs":{display:"flex",userSelect:"none"},":host .tabs > div":{padding:`${a.spacing50} ${a.spacing}`,cursor:"default"},":host .tabs > .selected":{color:a.tabSelectorSelectedColor},":host .border":{background:"var(--tab-selector-bar-color, #ccc)"},":host .border > .selected":{content:" ",width:0,height:"var(--tab-selector-bar-height, 2px)",background:a.tabSelectorSelectedColor,transition:"ease-out 0.2s"}});content=[j({class:"tab-holder"},j({class:"tabs",dataRef:"tabs"}),j({class:"border"},j({class:"selected",dataRef:"selected"}))),W()];constructor(){super(),this.initAttributes("anne","example")}addTabBody(e,t=!1){if(!e.hasAttribute("name"))throw Error("element has no name attribute",e);this.shadowRoot.append(e),this.setupTabs(),t&&(this.value=this.bodies.length-1),this.queueRender()}keyTab=e=>{let{tabs:t}=this.refs,s=[...t.children].indexOf(e.target);switch(e.key){case"ArrowLeft":this.value=(s+Number(t.children.length)-1)%t.children.length,t.children[this.value].focus(),e.preventDefault();break;case"ArrowRight":this.value=(s+1)%t.children.length,t.children[this.value].focus(),e.preventDefault();break;case" ":this.pickTab(e),e.preventDefault()}};get bodies(){return[...this.children].filter(e=>e.hasAttribute("name"))}pickTab=e=>{let{tabs:t}=this.refs,s=e.target,i=[...t.children].indexOf(s);i>-1&&(this.value=i)};setupTabs=()=>{let{tabs:e}=this.refs,t=[...this.querySelectorAll("[name]")];for(let s of(e.textContent="",t))e.append(j(s.getAttribute("name"),{tabindex:0}))};connectedCallback(){super.connectedCallback();let{tabs:e}=this.refs;e.addEventListener("click",this.pickTab),e.addEventListener("keydown",this.keyTab),this.setupTabs()}render(){let{tabs:e,selected:t}=this.refs,s=this.bodies;for(let i=0;i<s.length;i++){let a=s[i],l=e.children[i];this.value===Number(i)?(l.classList.add("selected"),t.style.marginLeft=`${l.offsetLeft-e.offsetLeft}px`,t.style.width=`${l.offsetWidth}px`,a.removeAttribute("hidden")):(l.classList.remove("selected"),a.setAttribute("hidden",""))}}}let D=E.elementCreator({tag:"tab-selector"});export{u as bodymovinPlayer,g as dataTable,C as filterBuilder,S as mapBox,T as markdownViewer,D as tabSelector,p as trackMouse,r as scriptTag,c as styleSheet};
//# sourceMappingURL=index.js.map
